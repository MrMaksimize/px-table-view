<!DOCTYPE html>
<html>

  <head>
    <meta charset="UTF-8">

    <title>px-table-view MVP Demos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel='stylesheet prefetch' href='../../px-design-system/css/px-design-system.min.css'>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/0.7.21/webcomponents.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.6/hammer.min.js'></script>

    <!-- TODO: pxm components -->
    <link rel="import" href="../px-table-view.html">
    <link rel="import" href="../px-table-row-swipe-actions-behavior.html">
    <link rel="import" href="../../px-navbar/px-navbar.html" />
    <link rel="import" href="../../iron-ajax/iron-ajax.html" />
    <link rel="import" href="../../iron-list/iron-list.html" />

    <style media="screen">
    body {
      -webkit-overflow-scrolling: touch;
      padding-top: 65px;
    }
    
    px-navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 200;
    }
    
    #content {
      overflow-x: auto;
    }
    
    .flagged {
      background-color: orange !important;
    }
    
    .deleted {
      background-color: red !important;
    }
    
    .table-row__media--icon:nth-of-type(even) {}
    
    .table-row__media--icon:nth-child(2n) {
      color: #dd6b1f;
    }

    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script type="text/javascript">
    if ('addEventListener' in document) {
      document.addEventListener('DOMContentLoaded', function() {
        FastClick.attach(document.body);
      }, false);
    }

    </script>
  </head>

  <body unresolved class="viewport viewport--full-height">

    <px-navbar title="px-table-view"></px-navbar>


    <div id="content" class="">
      <template id="tableViewTemplate" is="dom-bind">
        <iron-ajax url="./data.json" last-response="{{data}}" auto></iron-ajax>
        <iron-list id="ironList" items="[[data]]" as="item" class="table-view  table-view--small">
          <template>
            <div class="table-row table-row--tappable table-row--actionable" on-tap="handleSelect">
              <div class="">
                <div class="table-row__media table-row__media--icon" hidden="{{!item.icon}}">
                  <i class$="{{item.icon}}"></i>
                </div>
                <div class="table-row__content">
                  <div class="table-row__content__title">{{item.title}}</div>
                </div>
              </div>
              <div class="table-row__actions table-row__actions--right">
                <button on-tap="handleFlag" class="table-row__actions__button btn--full btn-flag">
                  Flag
                </button>
                <button on-tap="handleMore" class="table-row__actions__button btn--full btn-more">
                  More
                </button>
                <button on-tap="handleDelete" class="table-row__actions__button btn--full btn-delete">
                  Delete
                </button>
              </div>
            </div>
          </template>
        </iron-list>
      </template>
      <script type="text/javascript">
      var tmpl = document.getElementById('tableViewTemplate');
      tmpl.handleSelect = function(e) {
        console.log('handleSelect', e);
      };
      tmpl.handleMore = function(e) {
        console.log('handleMore', e);
      };
      tmpl.handleFlag = function(e) {
        console.log('handleFlag', e);
        $(e.currentTarget).parents('.table-row').toggleClass('flagged');
      };
      tmpl.handleDelete = function(e) {
        console.log('handleDelete', e);
        $(e.currentTarget).parents('.table-row').toggleClass('deleted');
      };
      document.addEventListener('WebComponentsReady', function() {
        setTimeout(function() {
          document.querySelector('iron-list').fire('iron-resize');
          Hammer.each(document.querySelectorAll(".table-row--actionable"), function(container) {
            var actions = new SwipeActions(container, Hammer.DIRECTION_HORIZONTAL);
            //outer.hammer.get('pan').requireFailure(actions.hammer.get('pan'));
            console.log('Adding Hammer', actions);
          });
        }, 50);
      });

      </script>


    </div>


  </body>

</html>
