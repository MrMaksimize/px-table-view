<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="../polymer-font-awesome/polymer-font-awesome.html"/>
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../iron-list/iron-list.html">
<link rel="import" href="../iron-selector/iron-selector.html">
<link rel="import" href="../iron-selector/iron-multi-selectable.html">
<link rel="import" href="px-table-view-behavior.html"/>
<link rel="import" href="px-table-view-pull-to-refresh-behavior.html"/>
<link rel="import" href="px-table-view-sortable-behavior.html"/>
<link rel="import" href="px-table-view-drilldown-behavior.html"/>
<link rel="import" href="px-table-row.html"/>
<!--
The `px-table-view` element is for displaying rows of `px-table-row` elements.
This element implements `iron-selector` for selectable table rows, by default the selected row is not styled.


<p>
  For demo visit <a href="demo.html" target="_blank">Full demo here</a> or <a href="demo/mvp1-demo.html" target="_blank">Mobile demo here</a>
</p>


> For a list of all demos visit  <a href="./demo" target="_blank">here</a>.

### Example Usage

```
<template id="tmpl1" is="dom-bind">
  <style is="custom-style">
    .custom-selected {
      color: crimson;
    }
  </style>
  <h4>Selected Item = {{selected}}</h4>
  <px-table-view modifer="small" attr-for-selected="name" selected="{{selected}}" selected-class="custom-selected">
      <px-table-row name="item-1" title="Item A" icon-left="fa:fa-pencil" modifier="tappable nav-right"></px-table-row>
      <px-table-row name="item-2" title="Item B" icon-left="fa:fa-pencil" modifier="tappable nav-right"></px-table-row>
      <px-table-row name="item-3" title="Item C" icon-left="fa:fa-pencil" modifier="tappable nav-right"></px-table-row>
  </px-table-view>
</template>
<script type="text/javascript">
  var tmpl = document.getElementById('tmpl1');
  tmpl.selected = 'item-2';
</script>
```

@element px-table-view.html
@demo demo.html
@homepage index.html
-->
<dom-module id="px-table-view">
  <link rel="import" type="css" href="css/px-table-view.css">
  <style media="screen">
    :host {
      display: block;
      position: relative;
    }
    :host .table-view {
      @apply(--px-table-view);
      			-webkit-overflow-scrolling: touch;
    }
    /*:host ::content {
      @apply(--px-table-row);
    }*/

    :host .sortable-chosen,
    :host ::content .sortable-chosen {
      box-shadow: 0 2px 10px rgba(0,0,0,0.45);
    }

    :host ::content .iron-selected .table-row
    :host .iron-selected .table-row,
    :host ::content .px-selected .table-row{
      background-color: var(--px-table-row-selected-background-color);
      color: var(--px-table-row-selected-color);
    }

    /* Handle when loading */
    :host.ptr-loading.ptr {
      -webkit-transition: all 0.25s ease;
      transition: all 0.25s ease;
    }

    :host.ptr-loading .ptr__content {
      -webkit-transition: all 0.25s ease;
      transition: all 0.25s ease;
      -webkit-transform: translate3d(0, 50px, 0);
      transform: translate3d(0, 50px, 0);
    }
    :host.ptr-loading .ptr__loader {
      -webkit-transform: translateY(0);
      transform: translateY(0);
    }
    :host.ptr-loading .ptr__loader,
    :host.ptr-loading .ptr__loading {
      display: block;
    }

    /* Drilldown Styles
    :host .is-drilldown{
      position: relative;
      overflow: auto;
      width: 100%;
    }
*/
    :host.is-drilldown-submenu{
      position: absolute;
      left: 100%;
      top: 0;
      width: 100%;
      z-index: -1;
      height: 100%;
      width: 100%;
      background-color: #fff;
      -webkit-transition: -webkit-transform 0.15s linear;
      transition: -webkit-transform 0.15s linear;
      transition: transform 0.15s linear;
      transition: transform 0.15s linear, -webkit-transform 0.15s linear;
    }
    :host.is-active{
      z-index: 1;
      display: block;
      -webkit-transform: translateX(-100%);
      transform: translateX(-100%);
    }






  </style>
  <template strip-whitespace>
    <template is="dom-if" if="{{tableData}}">
      <template id="tableRowTemplate" items="{{tableData}}" is="dom-repeat">
        <px-table-row item="{{item}}"></px-table-row>
      </template>
    </template>
    <div id="ptr" class="ptr__loader" hidden$="{{!pullToRefresh}}">
      <div class="ptr__loading">
        <span id="l1"></span>
        <span id="l2"></span>
        <span id="l3"></span>
      </div>
    </div>
    <div id="content" class="table-view">
      <content id="tableViewContent" select="px-table-row, [content]"></content>
    </div>
  </template>
  <script>
    Polymer({
      is: 'px-table-view',
      behaviors: [
        Polymer.IronMultiSelectableBehavior,
        Polymer.IronResizableBehavior,
        //  pxTableViewSortableBehavior,
        pxTableViewBehavior,
        pxTableViewDrilldownBehavior,
        pxTableViewPullToRefreshBehavior
      ],
      properties: {
        /**
         * The table data to set on the component
         */
        tableData: {
          type: Array
        },
        /**
         * The modifiers to apply to the table-view (bare, tiny, small, large, huge, etc)
         */
        modifier: {
          type: String,
          notify: true,
          reflectToAttribute: true,
          observer: '_handleModifier'
        },
        /**
         * If the table view is sortable set to true
         */
        isSortable: {
          type: Boolean,
          value: false
        },
        /**
         * If the table view is drilldown set to true
         */
        isDrilldown: {
          type: Boolean,
          value: false
        },
        /**
         * If the table view should be in edit mode (Checkbox and re-order).
         */
        editMode: {
          type: Boolean
        }
      },
      listeners: {
        'tap': '_handleTap'
      },
      /**
      * A reference to the table rows.
      * @property rows
      */
      get rows() {
        if(this.$.tableViewContent){
          return Polymer.dom(this.$.tableViewContent).getDistributedNodes();
        }
      },

      _handleModifier: function (newVal, oldVal) {
        var _this = this,
          klass,
          types;
        klass = 'table-view--' + oldVal;
        _this.toggleClass(klass, false, _this.$.content);
        if (_this.modifier) {
          types = _this.modifier.split(' ');
          for (var i = 0; i < types.length; i++) {
            klass = 'table-view--' + types[i];
            _this.toggleClass(klass, true, _this.$.content);
          }
        }
      },
      _handleTap: function (e) {
        e.preventDefault();
        var target = Polymer.dom(e).localTarget;
        this.fire('px-tap', target);


        if(this.isDrilldown){
          this._handleDrilldownTap(e);
        }

      }
    });
  </script>
</dom-module>
